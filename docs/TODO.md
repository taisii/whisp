# TODO


## 2. クリップボード履歴汚染の防止

### 背景
現在、音声入力の結果をクリップボードにコピーして自動貼り付けしているが、AquaVoiceのようにクリップボード履歴を汚染しない機能が求められている。クリップボードマネージャー（Maccy等）に音声入力の履歴が残らないようにしたい。

### 調査結果

#### 方法1: TransientType マーカーを使用（推奨）
[nspasteboard.org](http://nspasteboard.org/) によると、macOSには標準的なペーストボードタイプがあり、クリップボードマネージャーにコンテンツを無視させることができる。

**使用するタイプ:**
- `org.nspasteboard.TransientType` - 一時的なコンテンツ（数秒で削除される）
- `org.nspasteboard.ConcealedType` - 機密コンテンツ（パスワード等）
- `org.nspasteboard.AutoGeneratedType` - アプリが自動生成したコンテンツ

**実装例（Objective-C）:**
```objc
[generalPasteboard setData:[NSData data] forType:@"org.nspasteboard.TransientType"];
```

**Rustでの実装:**
`objc2`クレートを使用してNSPasteboardにアクセスし、上記のタイプを設定する。

#### 方法2: クリップボード内容の復元
1. 貼り付け前に現在のクリップボード内容を保存
2. テキストをクリップボードに書き込み
3. 自動貼り付け実行
4. 元のクリップボード内容を復元

AquaVoiceはこの方法も採用している（Changelogより）。

#### 参考リンク
- [nspasteboard.org](http://nspasteboard.org/) - ペーストボードタイプの仕様
- [Maccy (クリップボードマネージャー)](https://github.com/p0deje/Maccy) - TransientType等を無視する実装例
- [arboard](https://github.com/1Password/arboard) - Rust用クリップボードライブラリ

### 仕様
- **設定項目**: 「クリップボード履歴を汚染しない」トグル（auto_paste有効時のみ表示）
- **デフォルト**: オン
- **動作**: TransientTypeマーカーを付与してクリップボードに書き込み

### 実装タスク
- [x] `objc2`クレートを追加してNSPasteboardにアクセス
- [x] クリップボード書き込み時にTransientTypeマーカーを付与する関数を実装
- [x] 設定項目「avoid_clipboard_history」を追加
- [x] フロントエンドに設定UIを追加（auto_paste有効時のみ表示）
- [ ] 動作確認：Maccy等のクリップボードマネージャーで履歴に残らないことを確認

## 3. GitHub Actions リリースワークフロー

### 背景
GitHub で公開したプロジェクトについて、署名は行っていないものの、ダウンロードしてすぐに使える状態にしたい。タグプッシュ時に自動でビルドし、GitHub Releaseを作成する。

### 作成するファイル

`.github/workflows/release.yml`

```yaml
name: Release

on:
  push:
    tags:
      - 'v*'

jobs:
  build-macos:
    strategy:
      fail-fast: false
      matrix:
        include:
          - platform: macos-latest
            target: aarch64-apple-darwin
            arch: arm64
          - platform: macos-latest
            target: x86_64-apple-darwin
            arch: x64

    runs-on: ${{ matrix.platform }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2

      - name: Setup Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          targets: ${{ matrix.target }}

      - name: Install dependencies
        run: bun install

      - name: Build Tauri app
        uses: tauri-apps/tauri-action@v0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tagName: ${{ github.ref_name }}
          releaseName: 'Whisp ${{ github.ref_name }}'
          releaseBody: |
            ## インストール方法

            1. `.dmg` ファイルをダウンロード
            2. Whisp.app を `/Applications` にドラッグ
            3. **重要**: 初回起動前にターミナルで以下を実行:
               ```
               xattr -cr /Applications/Whisp.app
               ```
            4. アプリを起動
          releaseDraft: true
          prerelease: false
          args: --target ${{ matrix.target }}
```

### 生成されるアーティファクト

| ファイル | 対象 |
|---------|------|
| `Whisp_x.x.x_aarch64.dmg` | Apple Silicon Mac |
| `Whisp_x.x.x_x64.dmg` | Intel Mac |

### リリース手順（運用時）

```bash
# 1. バージョン更新（必要に応じて）
# tauri.conf.json, Cargo.toml, package.json のバージョンを更新

# 2. コミット
git add -A
git commit -m "chore: bump version to v0.1.0"

# 3. タグ作成とプッシュ
git tag v0.1.0
git push origin main --tags
```

### 実装タスク
- [x] `.github/workflows/` ディレクトリを作成
- [x] `release.yml` ワークフローファイルを作成
- [ ] テストタグをプッシュして動作を確認
- [ ] GitHub ReleasesページでDraftリリースとアーティファクトを確認

### 注意点
- **署名なし配布**: Apple Developer Programに未登録のため、ユーザーは `xattr -cr` コマンドの実行が必要
- **Draft Release**: 自動でDraftとして作成されるため、確認後に手動で公開する
- **バージョン管理**: タグ名とアプリバージョンは一致させる必要がある

## 実装優先度

1. **ダッシュボード/設定画面の整理** - shadcn導入が他機能のUI基盤になる
2. **クリップボード履歴汚染の防止** - UX改善、実装は比較的シンプル
3. **GitHub Actions リリースワークフロー** - 配布基盤の整備

## 4. OSS公開準備

### 背景
OSSとして公開するための最低限の体裁とメタ情報を整える。

### 実装タスク
- [x] ルートに `LICENSE` を追加（MIT）
- [x] `package.json` に `license` を明記
- [x] `src-tauri/Cargo.toml` に `license` を明記
- [ ] READMEのリリースURLを実際のリポジトリに差し替え
- [ ] 依存ライセンスの一覧化（必要なら `NOTICE` 追加）
